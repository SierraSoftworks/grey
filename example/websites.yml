---
ui:
  enabled: true
  listen: 127.0.0.1:3002

  # notices:
  #   - title: Example Notice
  #     description: This is an example notice message showcasing how you can alert users to something happening on your platform.
  #     timestamp: 2025-08-10T19:00:00Z

probes:
  - name: google.search
    policy:
      interval: 5s
      timeout: 2s
      retries: 3
    target: !Http
      url: https://google.com?q=grey+healthcheck+system
    validators:
      http.status: !OneOf [200]
      http.header.content-type: !Equals "text/html; charset=ISO-8859-1"
    tags:
      domain: google.com
      service: Search
  - name: bing.search
    policy:
      interval: 5s
      timeout: 2s
      retries: 3
    target: !Http
      url: https://www.bing.com
    validators:
      http.status: !OneOf [200]
      http.header.content-type: !Equals "text/html; charset=utf-8"
    tags:
      domain: bing.com
      service: Search
  - name: github.repo
    policy:
      interval: 5s
      timeout: 2s
      retries: 3
    target: !Http
      url: https://github.com/SierraSoftworks/grey
    validators:
      http.status: !OneOf [200]
    tags:
      domain: github.com
      service: Coding
  - name: bender.production.script
    policy:
      interval: 10s
      timeout: 5s
      retries: 2
    tags:
      domain: bender.sierrasoftworks.com
      service: Scripting
    target: !Script
      args:
        - https://bender.sierrasoftworks.com
      code: |
        const resp = await fetch(`${arguments[0]}/api/v1/quote/bender`, {
          headers: {
            "Accept": "application/json",
            ...getTraceHeaders()
          }
        })

        output["http.status"] = resp.status

        if (resp.status == 200) {
          const quote = await resp.json()
          output["quote.who"] = quote.who
        }

    validators:
      http.status: !Equals 200
      quote.who: !Equals "Bender"
